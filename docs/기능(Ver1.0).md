# Law-Crawling UI 시스템 기능 설명서

## 📋 개요

**Law-Crawling UI**는 법규관련 데이터수집 시스템의 웹 기반 관리 인터페이스입니다.  
Streamlit을 기반으로 구축되었으며, 크롤링된 데이터를 조회, 분석, 관리할 수 있는 통합 대시보드를 제공합니다.

---

## 🎯 주요 기능

### 1️⃣ 📊 대시보드 (Dashboard)

#### 목적

법규관련 데이터수집 현황을 한눈에 파악할 수 있는 통합 대시보드

#### 주요 지표 (KPI)

- **수집 사이트(pages)**: 수집 중인 사이트 수 및 페이지 수
- **오늘 수집**: 당일 수집한 사이트 수 및 첨부파일 수
- **3일 전 수집**: 3일 전부터의 수집 통계
- **7일 전 수집**: 7일 전부터의 수집 통계
- **전체 수집**: 시작 이래 누적 수집 통계
- **오류 발생**: 최근 24시간 내 발생한 오류 수

#### 수집된 데이터 조회

- **기간 선택**: 오늘, 3일, 7일 중 선택하여 조회
- **데이터 그리드**: 수집된 데이터를 테이블 형식으로 표시
  - 사이트명, 페이지, 제목 등 정보 표시
  - 단일 행 선택 가능

#### 상세 정보 탭

선택한 데이터의 상세 정보를 3개 탭으로 제공:

| 탭 | 설명 |
|----|------|
| 📄 렌더링 보기 | HTML 콘텐츠를 웹페이지처럼 시각화 |
| 🧾 HTML 코드 보기 | 원본 HTML 코드 표시 |
| 📥 첨부파일 | 수집된 첨부파일 목록 및 다운로드 |

---

### 2️⃣ 🔍 데이터 조회 (Search)

#### 목적

크롤링된 법규 데이터를 빠르게 검색할 수 있는 고급 검색 기능

#### 검색 옵션

**사이트 선택**

- 다중 사이트 선택 가능
- 선택하지 않으면 전체 사이트에서 검색
- 사이트명과 코드 함께 표시

**검색 키워드**

- 제목과 요약 내용에서 검색
- 자유 텍스트 입력

**액션 버튼**

- 🔍 **검색**: 입력한 조건으로 검색 실행
- 🔄 **초기화**: 검색 결과 및 입력값 초기화

#### 검색 결과

- 조건에 맞는 데이터를 그리드 형식으로 표시
- 결과가 없으면 "검색 결과가 없습니다" 메시지 표시

#### 상세 정보 표시

선택한 항목의 상세 정보:

- 사이트명 및 URL 링크
- 페이지명 및 상세 URL 링크
- 제목 및 원본 URL 링크
- 등록일 및 수집일시
- 첨부파일 목록 및 다운로드
- HTML 렌더링 및 코드 뷰

---

### 3️⃣ 📈 통계 분석 (Statistics)

#### 탭 1: 📈 수집 통계

**사이트별 수집 통계**

- 막대 그래프: 사이트별 게시글 수 시각화
- 통계 테이블:
  - 사이트명
  - 게시글수
  - 첨부파일수

#### 탭 2: 🏢 상세통계표

**핵심 지표**

- 전체 수집 사이트 수
- 오늘 수집 페이지 수
- 전체 수집 사이트 (게시글수)
- 전체 첨부파일 수

**상세 통계**

- 사이트·페이지별 게시글 수
- 사이트·페이지별 첨부파일 수
- 상세한 데이터프레임 형식 표시

---

### 4️⃣ 📋 로그 관리 (Log Management)

#### 탭 1: 📋 수집(Crawler) 로그

**기능**

- 📅 로그 날짜 선택: 조회할 날짜 선택
- 로그 파일 경로 표시
- 로그 내용 뷰어: 500px 높이의 텍스트 영역
- 📥 로그 파일 다운로드: 선택한 날짜의 로그 파일 다운로드

**특징**

- 해당 날짜 로그가 없을 시 에러 메시지 표시
- 한글 폰트 지원 (맑은고딕)

#### 탭 2: 🔍 UI(웹페이지) 로그

**기능**

- 실시간 UI 로그 표시
- 로그 파일 경로 표시
- 자동 스크롤: 최신 로그 하단으로 자동 스크롤
- 읽기 전용 텍스트 영역
- 📥 로그 파일 다운로드

**특징**

- JavaScript를 활용한 자동 스크롤 기능
- 시스템 로거와 연동

---

### 5️⃣ ⚙️ 설정 (Settings)

#### 탭 1: 🔧 시스템 소개

**시스템 소개**

- `ui/data/info.md` 파일의 마크다운 내용 표시
- 시스템에 대한 상세 설명

**대상 사이트 및 리스트**

- 확장 가능한 섹션 (expander)
- YAML 정보를 HTML 형식으로 변환하여 표시
- 수집 대상 사이트 목록 조회

#### 탭 2: 🖥️ 시스템 정보

**환경 정보**

- Python 버전: 3.9.7
- Streamlit 버전: 1.28.0
- 데이터베이스: SQLite

**경로 정보**

- 수집기(law-crawler) 폴더 경로
- DB 폴더 경로
- 첨부파일 폴더 경로
- 로그파일 폴더 경로

#### 탭 3: 📜 시스템 History

**시스템 히스토리**

- `ui/data/history.md` 파일의 마크다운 내용 표시
- 버전 업데이트 이력 및 변경 사항 기록

---

## 🏗️ 시스템 구조

### 사이드바 구성

```
⚖️ Law-Crawling
  ├── 법규관련사이트 데이터수집
  ├── 📋 메뉴 선택
  │   ├── 📊 대시보드
  │   ├── 🔍 데이터 조회
  │   ├── 📈 통계 분석
  │   ├── 📋 로그 관리
  │   └── ⚙️ 설정
  └── 🔄 시스템 상태
      ├── 크롤러 상태: 정상
      └── 마지막 수집: [시간표시]
```

### 페이지 레이아웃

- **페이지 설정**: 와이드 레이아웃, 확장된 사이드바
- **푸터**: 저작권 정보 (ⓒ 2025 Copyright Korea Fund Service Co., Ltd)

---

## 🔧 주요 기술 스택

| 항목 | 기술 |
|------|------|
| 프레임워크 | Streamlit |
| 데이터 처리 | Pandas, NumPy |
| 데이터 그리드 | st-aggrid (AgGrid) |
| 데이터베이스 | SQLite |
| 시간 처리 | datetime, timedelta |

---

## 📁 핵심 의존 모듈

```python
# 로깅
from ui.utils.logger import get_ui_log_contents, setup_logger

# 유틸리티
from ui.utils.misc_utils import configure_aggrid, configure_search_aggrid, get_log_data

# 데이터베이스
from ui.utils.db_util import (
    attach_list, detail_static, error_count_of_last_24h,
    get_site_and_code_dict, get_summary_list, search_law_summary,
    site_static, site_static_filecount, total_site_attach_counts,
    yaml_info_to_html
)

# DB 관리
from ui.utils.db_manager import DbManager

# 설정
from ui.utils.ui_settings import UiConfig
```

---

## 🎨 UI/UX 특징

### 이모지 활용

- 각 메뉴에 이모지 아이콘 사용으로 직관적 네비게이션
- 시각적 계층 구조 명확화

### 반응형 레이아웃

- 다중 컬럼 레이아웃으로 효율적인 공간 활용
- 모바일 친화적 와이드 레이아웃

### 대화형 요소

- 데이터 그리드 선택 및 필터링
- 동적 탭 구성
- 다운로드 버튼을 통한 파일 내보내기

### 마크다운 지원

- HTML 렌더링 가능
- 코드 블록 문법 강조
- 링크 및 이미지 삽입 가능

---

## 📊 데이터 기간 설정

시스템은 다음의 시간 범위로 데이터를 분석합니다:

| 기간 | 설명 |
|------|------|
| 오늘 | 현재 날짜 기준 |
| 3일 전 | 3일 이전부터의 데이터 |
| 7일 전 | 7일 이전부터의 데이터 |
| 전체 | 1900-01-01부터의 누적 데이터 |

---

## 🔐 상태 관리

### Session State 활용

- `search_results`: 검색 결과 캐싱
- `search_performed`: 검색 수행 여부 추적
- `selected_sites`: 선택된 사이트 저장
- `keyword`: 검색 키워드 저장

---

## ✅ 에러 처리

### 예외 처리

- 로그 파일 없음: 에러 메시지 표시
- 마크다운 파일 로드 실패: 에러 메시지 표시
- 첨부파일 미존재: 경고 메시지 표시 (빨간색)

### 유효성 검사

- 첨부파일 경로 검증
- 빈 데이터셋 처리

---

## 📌 사용자 가이드

### 대시보드 사용

1. 메인 화면에서 주요 지표 확인
2. 기간 선택 버튼으로 데이터 범위 변경
3. 행 선택하여 상세 정보 확인

### 데이터 검색

1. 사이트 선택 (선택 사항)
2. 검색 키워드 입력
3. 🔍 검색 버튼 클릭
4. 결과에서 항목 선택하여 상세 정보 확인
5. 필요시 🔄 초기화로 재검색

### 통계 확인

1. 📈 통계 분석 메뉴 선택
2. "수집 통계" 탭에서 차트 및 테이블 확인
3. "상세통계표" 탭에서 세부 통계 확인

### 로그 확인

1. 📋 로그 관리 메뉴 선택
2. "수집 로그" 또는 "UI 로그" 탭 선택
3. 필요한 경우 날짜 선택 (수집 로그만)
4. 📥 다운로드 버튼으로 저장

---

## 🚀 시스템 시작

```bash
# UI 실행
streamlit run ui/app.py

# 또는 배치 파일 사용
./run_ui.bat  # Windows
./run_ui.sh   # Linux/Mac
```

---

**마지막 업데이트**: 2025-10-21  
**시스템명**: Law-Crawling UI v1.0
