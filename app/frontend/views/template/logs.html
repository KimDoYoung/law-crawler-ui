{% extends "common/base.html" %} {% block style %}
<style>
  .log-container {
    @apply bg-white border border-gray-200 rounded-lg p-6 shadow-sm;
  }

  .log-content {
    @apply bg-gray-100 p-4 rounded-lg overflow-y-auto font-mono text-sm text-gray-700;
    max-height: 500px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .log-header {
    @apply bg-gray-100 px-4 py-2 rounded-t-lg border-b border-gray-300;
  }

  .tab-content {
    @apply bg-white border border-gray-200 rounded-lg mt-4;
  }
</style>
{% endblock %} {% block content %}
<div x-data="logsData()">
  <!-- í˜ì´ì§€ ì œëª© -->
  <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ“‹ ë¡œê·¸ ê´€ë¦¬, ìˆ˜ì§‘ ë¡œê·¸ì™€ ì‹œìŠ¤í…œ ë¡œê·¸ ì¡°íšŒ</h1>

  <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="bg-white border-b border-gray-200 mb-6">
    <div class="flex gap-4">
      <button
        @click="activeTab = 'crawler'"
        :class="activeTab === 'crawler' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
        class="px-4 py-3 font-semibold transition-colors"
      >
        ğŸ“‹ ìˆ˜ì§‘(Crawler) ë¡œê·¸
      </button>
      <button
        @click="activeTab = 'ui'"
        :class="activeTab === 'ui' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
        class="px-4 py-3 font-semibold transition-colors"
      >
        ğŸ” UI(ì›¹í˜ì´ì§€) ë¡œê·¸
      </button>
    </div>
  </div>

  <!-- íƒ­ 1: í¬ë¡¤ëŸ¬ ë¡œê·¸ -->
  <div x-show="activeTab === 'crawler'" class="log-container">
    <h2 class="text-xl font-bold text-gray-800 mb-4">
      ğŸ“‹ ìˆ˜ì§‘-Crawler ë¡œê·¸ ëª©ë¡
    </h2>

    <!-- 2:8 ë¶„í•  ë ˆì´ì•„ì›ƒ -->
    <div class="flex gap-4" style="min-height: 600px;">
      <!-- ì™¼ìª½ íŒ¨ë„ (2) - ë¡œê·¸ íŒŒì¼ ëª©ë¡ -->
      <div class="w-1/5 bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-y-auto">
        <h3 class="text-sm font-semibold text-gray-700 mb-3">ë¡œê·¸ íŒŒì¼</h3>

        <!-- ë¡œë”© ìƒíƒœ -->
        <div x-show="isLoadingFiles" class="text-center py-4">
          <i class="bi bi-hourglass text-lg text-blue-500"></i>
          <p class="text-xs text-gray-600 mt-2">ëª©ë¡ ë¡œë”© ì¤‘...</p>
        </div>

        <!-- íŒŒì¼ ëª©ë¡ -->
        <div x-show="!isLoadingFiles" class="space-y-1">
          <template x-for="file in crawlerLogFiles" :key="file.filename">
            <button
              type="button"
              @click="selectLogFile(file)"
              :class="selectedLogFile?.filename === file.filename ? 'bg-blue-100 text-blue-700 border-blue-300' : 'bg-white text-gray-700 hover:bg-gray-100'"
              class="w-full text-left px-3 py-2 rounded border text-xs transition-colors"
              :title="file.path"
            >
              <div class="font-medium truncate" x-text="file.filename"></div>
              <div class="text-xs text-gray-500 mt-1" x-text="file.modified_time"></div>
            </button>
          </template>

          <!-- íŒŒì¼ì´ ì—†ì„ ë•Œ -->
          <div x-show="!isLoadingFiles && crawlerLogFiles.length === 0" class="text-center py-8 text-gray-500 text-sm">
            ë¡œê·¸ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ (8) - ë¡œê·¸ ë‚´ìš© -->
      <div class="w-4/5 bg-white border border-gray-200 rounded-lg overflow-hidden flex flex-col">
        <!-- ë¡œê·¸ í—¤ë” (íŒŒì¼ ê²½ë¡œ ë° ë‹¤ìš´ë¡œë“œ) -->
        <div x-show="selectedLogFile" class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-xs text-gray-500 mb-1">ë¡œê·¸ íŒŒì¼ ê²½ë¡œ</p>
            <code class="text-sm text-gray-700 font-mono truncate block" x-text="crawlerLog.path"></code>
          </div>
          <button
            type="button"
            @click="downloadFile(crawlerLog.content, crawlerLog.filename)"
            class="ml-4 p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors flex-shrink-0"
            title="ë¡œê·¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ"
            x-show="crawlerLog.content"
          >
            <i class="bi bi-download text-xl"></i>
          </button>
        </div>

        <!-- ë¡œê·¸ ë‚´ìš© -->
        <div class="flex-1 overflow-y-auto p-4">
          <!-- ë¡œë”© ìƒíƒœ -->
          <div x-show="isLoadingContent" class="text-center py-8">
            <i class="bi bi-hourglass text-2xl text-blue-500"></i>
            <p class="text-gray-600 mt-2">ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>

          <!-- ë¡œê·¸ ë‚´ìš© í‘œì‹œ -->
          <div
            x-show="!isLoadingContent && crawlerLog.content"
            class="log-content"
            x-text="crawlerLog.content"
          ></div>

          <!-- ì„ íƒëœ íŒŒì¼ì´ ì—†ì„ ë•Œ -->
          <div x-show="!isLoadingContent && !selectedLogFile" class="text-center py-12 text-gray-400">
            <i class="bi bi-file-earmark-text text-5xl mb-4"></i>
            <p>ì™¼ìª½ì—ì„œ ë¡œê·¸ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</p>
          </div>

          <!-- ë‚´ìš©ì´ ì—†ì„ ë•Œ -->
          <div x-show="!isLoadingContent && selectedLogFile && !crawlerLog.content" class="text-center py-12 text-gray-400">
            <p>ë¡œê·¸ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- íƒ­ 2: UI ë¡œê·¸ -->
  <div x-show="activeTab === 'ui'" class="log-container">
    <h2 class="text-xl font-bold text-gray-800 mb-4">
      ğŸ” UI(ì›¹í˜ì´ì§€) ë¡œê·¸ ë³´ê¸°
    </h2>

    <!-- ë¡œë”© ìƒíƒœ -->
    <div x-show="isLoadingUI" class="text-center py-4">
      <i class="bi bi-hourglass text-2xl text-blue-500"></i>
      <p class="text-gray-600 mt-2">ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <!-- ë¡œê·¸ íŒŒì¼ ê²½ë¡œ -->
    <div x-show="!isLoadingUI && uiLog.path" class="mb-3 flex items-center justify-between">
      <p class="text-sm text-gray-600">
        <strong>ë¡œê·¸ íŒŒì¼ ê²½ë¡œ:</strong>
        <code class="bg-gray-100 px-2 py-1 rounded" x-text="uiLog.path"></code>
      </p>
      <button
        type="button"
        @click="downloadFile(uiLog.content, uiLog.filename)"
        class="ml-4 p-2 text-blue-500 hover:text-blue-700 hover:bg-blue-50 rounded transition-colors"
        title="ë¡œê·¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ"
        x-show="uiLog.content"
      >
        <i class="bi bi-download text-xl"></i>
      </button>
    </div>

    <!-- ë¡œê·¸ ë‚´ìš© -->
    <div x-show="!isLoadingUI && uiLog.content" class="log-content" x-text="uiLog.content"></div>

    <!-- ë‚´ìš©ì´ ì—†ì„ ë•Œ -->
    <div x-show="!isLoadingUI && !uiLog.content" class="text-center py-12 text-gray-400">
      <p>UI ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  function logsData() {
    return {
      activeTab: "crawler",
      isLoadingFiles: false,
      isLoadingContent: false,
      isLoadingUI: false,
      crawlerLogFiles: [],
      selectedLogFile: null,
      crawlerLog: {
        content: "",
        path: "",
        filename: "",
      },
      uiLog: {
        content: "",
        path: "",
        filename: "",
      },

      async init() {
        await this.loadCrawlerLogFiles();
        await this.loadUILog();
      },

      async loadCrawlerLogFiles() {
        this.isLoadingFiles = true;
        try {
          const response = await fetch("/api/v1/logs/crawler/files");
          if (response.ok) {
            this.crawlerLogFiles = await response.json();
            // ì²« ë²ˆì§¸ íŒŒì¼ ìë™ ì„ íƒ
            if (this.crawlerLogFiles.length > 0) {
              await this.selectLogFile(this.crawlerLogFiles[0]);
            }
          }
        } catch (error) {
          console.error("í¬ë¡¤ëŸ¬ ë¡œê·¸ íŒŒì¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:", error);
          this.crawlerLogFiles = [];
        } finally {
          this.isLoadingFiles = false;
        }
      },

      async selectLogFile(file) {
        this.selectedLogFile = file;
        this.isLoadingContent = true;
        try {
          const response = await fetch(
            `/api/v1/logs/crawler/file?filename=${encodeURIComponent(file.filename)}`
          );
          if (response.ok) {
            this.crawlerLog = await response.json();
          }
        } catch (error) {
          console.error("í¬ë¡¤ëŸ¬ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:", error);
          this.crawlerLog = {
            content: "ë¡œê·¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",
            path: "",
            filename: "",
          };
        } finally {
          this.isLoadingContent = false;
        }
      },

      async loadUILog() {
        this.isLoadingUI = true;
        try {
          const response = await fetch("/api/v1/logs/ui");
          if (response.ok) {
            this.uiLog = await response.json();
          }
        } catch (error) {
          console.error("UI ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:", error);
          this.uiLog = {
            content: "ë¡œê·¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",
            path: "",
            filename: "",
          };
        } finally {
          this.isLoadingUI = false;
        }
      },

      downloadFile(content, filename) {
        const element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(content)
        );
        element.setAttribute("download", filename);
        element.style.display = "none";
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
      },
    };
  }
</script>
{% endblock %}
