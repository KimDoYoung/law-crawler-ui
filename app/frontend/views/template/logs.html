{% extends "common/base.html" %} {% block style %}
<style>
  .log-container {
    @apply bg-white border border-gray-200 rounded-lg p-6 shadow-sm;
  }

  .log-content {
    @apply bg-gray-100 p-4 rounded-lg overflow-y-auto font-mono text-sm text-gray-700;
    max-height: 500px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .log-header {
    @apply bg-gray-100 px-4 py-2 rounded-t-lg border-b border-gray-300;
  }

  .tab-content {
    @apply bg-white border border-gray-200 rounded-lg mt-4;
  }
</style>
{% endblock %} {% block content %}
<div x-data="logsData()">
  <!-- í˜ì´ì§€ ì œëª© -->
  <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“‹ ë¡œê·¸ ê´€ë¦¬</h1>
  <p class="text-gray-600 mb-6">ìˆ˜ì§‘ ë¡œê·¸ì™€ ì‹œìŠ¤í…œ ë¡œê·¸ ì¡°íšŒ</p>

  <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="bg-white border-b border-gray-200 mb-6">
    <div class="flex gap-4">
      <button
        @click="activeTab = 'crawler'"
        :class="activeTab === 'crawler' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
        class="px-4 py-3 font-semibold transition-colors"
      >
        ğŸ“‹ ìˆ˜ì§‘(Crawler) ë¡œê·¸
      </button>
      <button
        @click="activeTab = 'ui'"
        :class="activeTab === 'ui' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
        class="px-4 py-3 font-semibold transition-colors"
      >
        ğŸ” UI(ì›¹í˜ì´ì§€) ë¡œê·¸
      </button>
    </div>
  </div>

  <!-- íƒ­ 1: í¬ë¡¤ëŸ¬ ë¡œê·¸ -->
  <div x-show="activeTab === 'crawler'" class="log-container">
    <h2 class="text-xl font-bold text-gray-800 mb-4">
      ğŸ“‹ ìˆ˜ì§‘-Crawler ë¡œê·¸ ëª©ë¡
    </h2>

    <!-- ë¡œê·¸ ë‚ ì§œ ì„ íƒ -->
    <div class="mb-4">
      <label class="block text-sm font-semibold text-gray-700 mb-2"
        >ğŸ“… ë¡œê·¸ ë‚ ì§œ</label
      >
      <select
        x-model="selectedDate"
        @change="loadCrawlerLog()"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
        title="ë¡œê·¸ ë‚ ì§œ ì„ íƒ"
      >
        <template x-for="dateOption in dates" :key="dateOption.date">
          <option :value="dateOption.date" x-text="dateOption.label"></option>
        </template>
      </select>
    </div>

    <!-- ë¡œë”© ìƒíƒœ -->
    <div x-show="isLoading" class="text-center py-4">
      <i class="bi bi-hourglass text-2xl text-blue-500"></i>
      <p class="text-gray-600 mt-2">ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <!-- ë¡œê·¸ íŒŒì¼ ê²½ë¡œ -->
    <div x-show="!isLoading && crawlerLog.path" class="mb-3">
      <p class="text-sm text-gray-600">
        <strong>ë¡œê·¸ íŒŒì¼ ê²½ë¡œ:</strong>
        <code
          class="bg-gray-100 px-2 py-1 rounded"
          x-text="crawlerLog.path"
        ></code>
      </p>
    </div>

    <!-- ë¡œê·¸ ë‚´ìš© -->
    <div
      x-show="!isLoading"
      class="log-content"
      x-text="crawlerLog.content"
    ></div>

    <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <div x-show="!isLoading && crawlerLog.content" class="mt-4">
      <button
        @click="downloadFile(crawlerLog.content, crawlerLog.filename)"
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2"
      >
        <i class="bi bi-download"></i>
        ğŸ“¥ ë¡œê·¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      </button>
    </div>
  </div>

  <!-- íƒ­ 2: UI ë¡œê·¸ -->
  <div x-show="activeTab === 'ui'" class="log-container">
    <h2 class="text-xl font-bold text-gray-800 mb-4">
      ğŸ” UI(ì›¹í˜ì´ì§€) ë¡œê·¸ ë³´ê¸°
    </h2>

    <!-- ë¡œë”© ìƒíƒœ -->
    <div x-show="isLoading" class="text-center py-4">
      <i class="bi bi-hourglass text-2xl text-blue-500"></i>
      <p class="text-gray-600 mt-2">ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <!-- ë¡œê·¸ íŒŒì¼ ê²½ë¡œ -->
    <div x-show="!isLoading && uiLog.path" class="mb-3">
      <p class="text-sm text-gray-600">
        <strong>ë¡œê·¸ íŒŒì¼ ê²½ë¡œ:</strong>
        <code class="bg-gray-100 px-2 py-1 rounded" x-text="uiLog.path"></code>
      </p>
    </div>

    <!-- ë¡œê·¸ ë‚´ìš© -->
    <div x-show="!isLoading" class="log-content" x-text="uiLog.content"></div>

    <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <div x-show="!isLoading && uiLog.content" class="mt-4">
      <button
        @click="downloadFile(uiLog.content, uiLog.filename)"
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2"
      >
        <i class="bi bi-download"></i>
        ğŸ“¥ ë¡œê·¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
      </button>
    </div>
  </div>
</div>
{% endblock %} {% block script %}
<script>
  function logsData() {
    return {
      activeTab: "crawler",
      dates: [],
      selectedDate: "",
      isLoading: false,
      crawlerLog: {
        content: "",
        path: "",
        filename: "",
      },
      uiLog: {
        content: "",
        path: "",
        filename: "",
      },

      async init() {
        await this.loadDates();
        if (this.dates.length > 0) {
          this.selectedDate = this.dates[0].date;
          await this.loadCrawlerLog();
        }
        await this.loadUILog();
      },

      async loadDates() {
        try {
          const response = await fetch("/api/v1/logs/dates?days=7");
          if (response.ok) {
            this.dates = await response.json();
          }
        } catch (error) {
          console.error("ë¡œê·¸ ë‚ ì§œ ë¡œë“œ ì‹¤íŒ¨:", error);
        }
      },

      async loadCrawlerLog() {
        this.isLoading = true;
        try {
          const response = await fetch(
            `/api/v1/logs/crawler?date=${this.selectedDate}`
          );
          if (response.ok) {
            this.crawlerLog = await response.json();
          }
        } catch (error) {
          console.error("í¬ë¡¤ëŸ¬ ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:", error);
          this.crawlerLog = {
            content: "ë¡œê·¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",
            path: "",
            filename: "",
          };
        } finally {
          this.isLoading = false;
        }
      },

      async loadUILog() {
        try {
          const response = await fetch("/api/v1/logs/ui");
          if (response.ok) {
            this.uiLog = await response.json();
          }
        } catch (error) {
          console.error("UI ë¡œê·¸ ë¡œë“œ ì‹¤íŒ¨:", error);
          this.uiLog = {
            content: "ë¡œê·¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ",
            path: "",
            filename: "",
          };
        }
      },

      downloadFile(content, filename) {
        const element = document.createElement("a");
        element.setAttribute(
          "href",
          "data:text/plain;charset=utf-8," + encodeURIComponent(content)
        );
        element.setAttribute("download", filename);
        element.style.display = "none";
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
      },
    };
  }
</script>
{% endblock %}
